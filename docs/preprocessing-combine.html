<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Combining methods together | Getting started with mdatools for R</title>
  <meta name="description" content="This is a user guide for mdatools — R package for preprocessing, exploring and analysis of multivariate data. The package provides methods mostly common for Chemometrics. The general idea of the package is to collect most of the common chemometric methods and give a similar user interface for using them. So if a user knows how to make a model and visualize results for one method, he or she can easily do this for the others." />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Combining methods together | Getting started with mdatools for R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a user guide for mdatools — R package for preprocessing, exploring and analysis of multivariate data. The package provides methods mostly common for Chemometrics. The general idea of the package is to collect most of the common chemometric methods and give a similar user interface for using them. So if a user knows how to make a model and visualize results for one method, he or she can easily do this for the others." />
  <meta name="github-repo" content="svkucheryavski/mdatools.bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Combining methods together | Getting started with mdatools for R" />
  
  <meta name="twitter:description" content="This is a user guide for mdatools — R package for preprocessing, exploring and analysis of multivariate data. The package provides methods mostly common for Chemometrics. The general idea of the package is to collect most of the common chemometric methods and give a similar user interface for using them. So if a user knows how to make a model and visualize results for one method, he or she can easily do this for the others." />
  

<meta name="author" content="Sergey Kucheryavskiy" />


<meta name="date" content="2022-11-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="preprocessing--varsel.html"/>
<link rel="next" href="pca.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="news.html"><a href="news.html"><i class="fa fa-check"></i>What is new</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="overview--what-mdatools-can-do.html"><a href="overview--what-mdatools-can-do.html"><i class="fa fa-check"></i>What mdatools can do?</a></li>
<li class="chapter" data-level="" data-path="overview--how-to-install.html"><a href="overview--how-to-install.html"><i class="fa fa-check"></i>How to install</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datasets.html"><a href="datasets.html"><i class="fa fa-check"></i>Datasets and plots</a>
<ul>
<li class="chapter" data-level="" data-path="datasets--attributes-and-factors.html"><a href="datasets--attributes-and-factors.html"><i class="fa fa-check"></i>Attributes and factors</a>
<ul>
<li class="chapter" data-level="" data-path="datasets--attributes-and-factors.html"><a href="datasets--attributes-and-factors.html#attributes-for-plots"><i class="fa fa-check"></i>Attributes for plots</a></li>
<li class="chapter" data-level="" data-path="datasets--attributes-and-factors.html"><a href="datasets--attributes-and-factors.html#special-methods-for-data-transformations"><i class="fa fa-check"></i>Special methods for data transformations</a></li>
<li class="chapter" data-level="" data-path="datasets--attributes-and-factors.html"><a href="datasets--attributes-and-factors.html#data-frames-with-factors"><i class="fa fa-check"></i>Data frames with factors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datasets--excluding-rows-and-columns.html"><a href="datasets--excluding-rows-and-columns.html"><i class="fa fa-check"></i>Excluding rows and columns</a></li>
<li class="chapter" data-level="" data-path="datasets--simple-plots.html"><a href="datasets--simple-plots.html"><i class="fa fa-check"></i>Simple plots</a>
<ul>
<li class="chapter" data-level="" data-path="datasets--simple-plots.html"><a href="datasets--simple-plots.html#scatter-plots"><i class="fa fa-check"></i>Scatter plots</a></li>
<li class="chapter" data-level="" data-path="datasets--simple-plots.html"><a href="datasets--simple-plots.html#line-plots"><i class="fa fa-check"></i>Line plots</a></li>
<li class="chapter" data-level="" data-path="datasets--simple-plots.html"><a href="datasets--simple-plots.html#bar-and-errorbar-plots"><i class="fa fa-check"></i>Bar and errorbar plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datasets--group-plots.html"><a href="datasets--group-plots.html"><i class="fa fa-check"></i>Plots for groups of objects</a>
<ul>
<li class="chapter" data-level="" data-path="datasets--group-plots.html"><a href="datasets--group-plots.html#one-matrix-or-data-frame"><i class="fa fa-check"></i>One matrix or data frame</a></li>
<li class="chapter" data-level="" data-path="datasets--group-plots.html"><a href="datasets--group-plots.html#list-with-matrices-or-data-frames"><i class="fa fa-check"></i>List with matrices or data frames</a></li>
<li class="chapter" data-level="" data-path="datasets--group-plots.html"><a href="datasets--group-plots.html#use-factors-to-split-a-dataset-into-groups"><i class="fa fa-check"></i>Use factors to split a dataset into groups</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datasets--images.html"><a href="datasets--images.html"><i class="fa fa-check"></i>Working with images</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i>Preprocessing</a>
<ul>
<li class="chapter" data-level="" data-path="preprocessing--autoscaling.html"><a href="preprocessing--autoscaling.html"><i class="fa fa-check"></i>Autoscaling</a></li>
<li class="chapter" data-level="" data-path="preprocessing--baseline.html"><a href="preprocessing--baseline.html"><i class="fa fa-check"></i>Correction of spectral baseline</a>
<ul>
<li class="chapter" data-level="" data-path="preprocessing--baseline.html"><a href="preprocessing--baseline.html#baseline-correction-with-asymmetric-least-squares"><i class="fa fa-check"></i>Baseline correction with asymmetric least squares</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preprocessing--savgol.html"><a href="preprocessing--savgol.html"><i class="fa fa-check"></i>Smoothing and derivatives</a></li>
<li class="chapter" data-level="" data-path="preprocessing--eltransform.html"><a href="preprocessing--eltransform.html"><i class="fa fa-check"></i>Element wise transformations</a></li>
<li class="chapter" data-level="" data-path="preprocessing--varsel.html"><a href="preprocessing--varsel.html"><i class="fa fa-check"></i>Variable selection as preprocessing method</a></li>
<li class="chapter" data-level="" data-path="preprocessing-combine.html"><a href="preprocessing-combine.html"><i class="fa fa-check"></i>Combining methods together</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i>Principal component analysis</a>
<ul>
<li class="chapter" data-level="" data-path="pca--models-and-results.html"><a href="pca--models-and-results.html"><i class="fa fa-check"></i>Models and results</a>
<ul>
<li class="chapter" data-level="" data-path="pca--models-and-results.html"><a href="pca--models-and-results.html#model-calibration"><i class="fa fa-check"></i>Model calibration</a></li>
<li class="chapter" data-level="" data-path="pca--models-and-results.html"><a href="pca--models-and-results.html#model-validation"><i class="fa fa-check"></i>Model validation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pca--plots.html"><a href="pca--plots.html"><i class="fa fa-check"></i>Plotting methods</a>
<ul>
<li class="chapter" data-level="" data-path="pca--plots.html"><a href="pca--plots.html#support-for-images"><i class="fa fa-check"></i>Support for images</a></li>
<li class="chapter" data-level="" data-path="pca--plots.html"><a href="pca--plots.html#manual-x-values-for-loading-line-plot"><i class="fa fa-check"></i>Manual x-values for loading line plot</a></li>
<li class="chapter" data-level="" data-path="pca--plots.html"><a href="pca--plots.html#excluding-rows-and-columns"><i class="fa fa-check"></i>Excluding rows and columns</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pca--distances-and-limits.html"><a href="pca--distances-and-limits.html"><i class="fa fa-check"></i>Distances and critical limits</a>
<ul>
<li class="chapter" data-level="" data-path="pca--distances-and-limits.html"><a href="pca--distances-and-limits.html#distance-to-model-and-score-distance"><i class="fa fa-check"></i>Distance to model and score distance</a></li>
<li class="chapter" data-level="" data-path="pca--distances-and-limits.html"><a href="pca--distances-and-limits.html#critical-limits"><i class="fa fa-check"></i>Critical limits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pca--model-complexity.html"><a href="pca--model-complexity.html"><i class="fa fa-check"></i>Model complexity</a></li>
<li class="chapter" data-level="" data-path="pca--randomized-algorithm.html"><a href="pca--randomized-algorithm.html"><i class="fa fa-check"></i>Randomized PCA algorithms</a></li>
<li class="chapter" data-level="" data-path="pca--pcv.html"><a href="pca--pcv.html"><i class="fa fa-check"></i>Procrustes cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pls.html"><a href="pls.html"><i class="fa fa-check"></i>Partial least squares regression</a>
<ul>
<li class="chapter" data-level="" data-path="pls--models-and-results.html"><a href="pls--models-and-results.html"><i class="fa fa-check"></i>Models and results</a>
<ul>
<li class="chapter" data-level="" data-path="pls--models-and-results.html"><a href="pls--models-and-results.html#model-calibration-1"><i class="fa fa-check"></i>Model calibration</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="validation.html"><a href="validation.html"><i class="fa fa-check"></i>Validation</a></li>
<li class="chapter" data-level="" data-path="pls--plotting-methods.html"><a href="pls--plotting-methods.html"><i class="fa fa-check"></i>Plotting methods</a>
<ul>
<li class="chapter" data-level="" data-path="pls--plotting-methods.html"><a href="pls--plotting-methods.html#excluding-rows-and-columns-1"><i class="fa fa-check"></i>Excluding rows and columns</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pls--variable-selection.html"><a href="pls--variable-selection.html"><i class="fa fa-check"></i>Variable selection</a></li>
<li class="chapter" data-level="" data-path="pls--distances-and-outliers.html"><a href="pls--distances-and-outliers.html"><i class="fa fa-check"></i>Distances and outlier detection</a>
<ul>
<li class="chapter" data-level="" data-path="pls--distances-and-outliers.html"><a href="pls--distances-and-outliers.html#distance-plot-for-x-decomposition"><i class="fa fa-check"></i>Distance plot for X-decomposition</a></li>
<li class="chapter" data-level="" data-path="pls--distances-and-outliers.html"><a href="pls--distances-and-outliers.html#distance-plot-for-y-decomposition-and-total-distance"><i class="fa fa-check"></i>Distance plot for Y-decomposition and total distance</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pls--randomization-test.html"><a href="pls--randomization-test.html"><i class="fa fa-check"></i>Randomization test</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plsda.html"><a href="plsda.html"><i class="fa fa-check"></i>PLS Discriminant Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="plsda--calibration.html"><a href="plsda--calibration.html"><i class="fa fa-check"></i>Calibration of PLS-DA model</a></li>
<li class="chapter" data-level="" data-path="plsda-classification-plots.html"><a href="plsda-classification-plots.html"><i class="fa fa-check"></i>Classification plots</a></li>
<li class="chapter" data-level="" data-path="plsda--performance-plots.html"><a href="plsda--performance-plots.html"><i class="fa fa-check"></i>Performance plots</a></li>
<li class="chapter" data-level="" data-path="plsda--predictions.html"><a href="plsda--predictions.html"><i class="fa fa-check"></i>Predictions for a new data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="simca.html"><a href="simca.html"><i class="fa fa-check"></i>SIMCA/DD-SIMCA classification</a>
<ul>
<li class="chapter" data-level="" data-path="simca--calibration-and-validation.html"><a href="simca--calibration-and-validation.html"><i class="fa fa-check"></i>Calibration and validation</a>
<ul>
<li class="chapter" data-level="" data-path="simca--calibration-and-validation.html"><a href="simca--calibration-and-validation.html#cross-validation"><i class="fa fa-check"></i>Cross-validation</a></li>
<li class="chapter" data-level="" data-path="simca--calibration-and-validation.html"><a href="simca--calibration-and-validation.html#predictions-and-validation-with-a-test-set"><i class="fa fa-check"></i>Predictions and validation with a test set</a></li>
<li class="chapter" data-level="" data-path="simca--calibration-and-validation.html"><a href="simca--calibration-and-validation.html#class-belonging-probabilities"><i class="fa fa-check"></i>Class belonging probabilities</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="simca--multiclass-classification.html"><a href="simca--multiclass-classification.html"><i class="fa fa-check"></i>Multiclass classification</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ipls.html"><a href="ipls.html"><i class="fa fa-check"></i>Interval PLS</a>
<ul>
<li class="chapter" data-level="" data-path="ipls.html"><a href="ipls.html#forward-ipls"><i class="fa fa-check"></i>Forward iPLS</a></li>
<li class="chapter" data-level="" data-path="ipls.html"><a href="ipls.html#running-full-procedure"><i class="fa fa-check"></i>Running full procedure</a></li>
<li class="chapter" data-level="" data-path="ipls.html"><a href="ipls.html#using-test-set-for-validation"><i class="fa fa-check"></i>Using test set for validation</a></li>
<li class="chapter" data-level="" data-path="ipls.html"><a href="ipls.html#backward-ipls"><i class="fa fa-check"></i>Backward iPLS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mcr.html"><a href="mcr.html"><i class="fa fa-check"></i>Multivariate Curve Resolution</a>
<ul>
<li class="chapter" data-level="" data-path="mcr--purity.html"><a href="mcr--purity.html"><i class="fa fa-check"></i>Purity based</a>
<ul>
<li class="chapter" data-level="" data-path="mcr--purity.html"><a href="mcr--purity.html#an-example"><i class="fa fa-check"></i>An example</a></li>
<li class="chapter" data-level="" data-path="mcr--purity.html"><a href="mcr--purity.html#purity-values-and-spectra"><i class="fa fa-check"></i>Purity values and spectra</a></li>
<li class="chapter" data-level="" data-path="mcr--purity.html"><a href="mcr--purity.html#predictions"><i class="fa fa-check"></i>Predictions</a></li>
<li class="chapter" data-level="" data-path="mcr--purity.html"><a href="mcr--purity.html#tuning-the-offset-parameter"><i class="fa fa-check"></i>Tuning the offset parameter</a></li>
<li class="chapter" data-level="" data-path="mcr--purity.html"><a href="mcr--purity.html#providing-indices-of-pure-variables"><i class="fa fa-check"></i>Providing indices of pure variables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mcr--als.html"><a href="mcr--als.html"><i class="fa fa-check"></i>Alternating least squares</a>
<ul>
<li class="chapter" data-level="" data-path="mcr--als.html"><a href="mcr--als.html#non-negativity"><i class="fa fa-check"></i>Non-negativity</a></li>
<li class="chapter" data-level="" data-path="mcr--als.html"><a href="mcr--als.html#constraints"><i class="fa fa-check"></i>Constraints</a></li>
<li class="chapter" data-level="" data-path="mcr--als.html"><a href="mcr--als.html#initial-estimates"><i class="fa fa-check"></i>Initial estimates</a></li>
<li class="chapter" data-level="" data-path="mcr--als.html"><a href="mcr--als.html#forcing-contribution-and-spectral-values"><i class="fa fa-check"></i>Forcing contribution and spectral values</a></li>
<li class="chapter" data-level="" data-path="mcr--als.html"><a href="mcr--als.html#overview-of-resolving-process-and-results"><i class="fa fa-check"></i>Overview of resolving process and results</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Getting started with mdatools for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="preprocessing-combine" class="section level2 unnumbered hasAnchor">
<h2>Combining methods together<a href="preprocessing-combine.html#preprocessing-combine" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>From <em>v.0.12.0</em> it is possible to combine several preprocessing methods and their parameters into one R object (list) and then apply them all at once in a correct order. This is particularly useful when you create a model based on a preprocessed calibration set and then want to apply the model to a new data. Which means the new data must be preprocessed in the same way as the data you used to create the model. The new functionality makes this easier.</p>
<p>First of all, you can see the list of preprocessing methods available for this feature as well as all necessary information about them if you run <code>prep.list()</code> as shown below:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="preprocessing-combine.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prep.list</span>()</span></code></pre></div>
<pre><code>## 
## 
## List of available preprocessing methods:
## 
## 
##  Standard normal variate normalization.
##  ---------------
##  name: &#39;snv&#39;
##  no parameters required
## 
## 
##  Transform reflectance spectra to Kubelka-Munk units.
##  ---------------
##  name: &#39;ref2km&#39;
##  no parameters required
## 
## 
##  Multiplicative scatter correction.
##  ---------------
##  name: &#39;msc&#39;
##  parameters:
##   &#39;mspectrum&#39;: mean spectrum (if NULL will be computed based on data).
## 
## 
##  Transformation of data values using math functions (log, sqrt, etc.).
##  ---------------
##  name: &#39;transform&#39;
##  parameters:
##   &#39;fun&#39;: function to transform the values (e.g. &#39;log&#39;)
## 
## 
##  Select user-defined variables (columns of dataset).
##  ---------------
##  name: &#39;varsel&#39;
##  parameters:
##   &#39;var.ind&#39;: indices of variables (columns) to select.
## 
## 
##  Normalization.
##  ---------------
##  name: &#39;norm&#39;
##  parameters:
##   &#39;type&#39;: type of normalization (&#39;area&#39;, &#39;sum&#39;, &#39;length&#39;, &#39;is&#39;, &#39;snv&#39;, &#39;pqn&#39;).
##   &#39;col.ind&#39;: indices of columns (variables) for normalization to internal standard peak.
## 
## 
##  Savitzky-Golay filter.
##  ---------------
##  name: &#39;savgol&#39;
##  parameters:
##   &#39;width&#39;: width of the filter.
##   &#39;porder&#39;: polynomial order.
##   &#39;dorder&#39;: derivative order.
## 
## 
##  Asymmetric least squares baseline correction.
##  ---------------
##  name: &#39;alsbasecorr&#39;
##  parameters:
##   &#39;plambda&#39;: power of the penalty parameter (e.g. if plambda = 5, lambda = 10^5)
##   &#39;p&#39;: assymetry ratio (should be between 0 and 1)
##   &#39;max.niter&#39;: maximum number of iterations
## 
## 
##  ---------------
##  name: &#39;autoscale&#39;
##  parameters:
##   &#39;center&#39;: a logical value or vector with numbers for centering.
##   &#39;scale&#39;: a logical value or vector with numbers for weighting.
##   &#39;max.cov&#39;: columns with coefficient of variation (in percent) below `max.cov` will not be scaled</code></pre>
<p>What you need to know is the name of the method and which parameters you can or want to provide (if you do not specify any parameters, default values will be used instead).</p>
<p>Let’s start with a simple example, where we want to take spectra from <em>Simdata</em>, and, first of all, apply Savitzky-Golay with filter width = 5, polynomial degree = 2 and derivative order = 1. Then we want to normalize them using SNV and get rid of all spectral values from 300 nm and above. Here is how to make a preprocessing object for this sequence:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="preprocessing-combine.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(simdata)</span>
<span id="cb60-2"><a href="preprocessing-combine.html#cb60-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> simdata<span class="sc">$</span>wavelength</span>
<span id="cb60-3"><a href="preprocessing-combine.html#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="preprocessing-combine.html#cb60-4" aria-hidden="true" tabindex="-1"></a>myprep <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb60-5"><a href="preprocessing-combine.html#cb60-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">prep</span>(<span class="st">&quot;savgol&quot;</span>, <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">5</span>, <span class="at">porder =</span> <span class="dv">2</span>, <span class="at">dorder =</span> <span class="dv">1</span>)),</span>
<span id="cb60-6"><a href="preprocessing-combine.html#cb60-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">prep</span>(<span class="st">&quot;snv&quot;</span>),</span>
<span id="cb60-7"><a href="preprocessing-combine.html#cb60-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">prep</span>(<span class="st">&quot;varsel&quot;</span>, <span class="fu">list</span>(<span class="at">var.ind =</span> w <span class="sc">&lt;</span> <span class="dv">300</span>))</span>
<span id="cb60-8"><a href="preprocessing-combine.html#cb60-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now you can apply the whole sequence to any spectral data by using function <code>employ.prep()</code>:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="preprocessing-combine.html#cb61-1" aria-hidden="true" tabindex="-1"></a>Xc <span class="ot">&lt;-</span> simdata<span class="sc">$</span>spectra.c</span>
<span id="cb61-2"><a href="preprocessing-combine.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(Xc, <span class="st">&quot;xaxis.values&quot;</span>) <span class="ot">&lt;-</span> w</span>
<span id="cb61-3"><a href="preprocessing-combine.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(Xc, <span class="st">&quot;xaxis.name&quot;</span>) <span class="ot">&lt;-</span> <span class="st">&quot;Wavelength, nm&quot;</span></span>
<span id="cb61-4"><a href="preprocessing-combine.html#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="preprocessing-combine.html#cb61-5" aria-hidden="true" tabindex="-1"></a>Xcp <span class="ot">&lt;-</span> <span class="fu">employ.prep</span>(myprep, Xc)</span>
<span id="cb61-6"><a href="preprocessing-combine.html#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="preprocessing-combine.html#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb61-8"><a href="preprocessing-combine.html#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mdaplot</span>(Xc, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">350</span>))</span>
<span id="cb61-9"><a href="preprocessing-combine.html#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mdaplot</span>(Xcp, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">350</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-50-1.png" width="864" /></p>
<p>Now let’s consider another example, where we have a calibration set and a test set. We need to create preprocessing sequence for the calibration set and, let’s say, we ended up with the following sequence:</p>
<ul>
<li>Reflectance to absorbance transformation</li>
<li>MSC correction</li>
<li>Normalization to unit area</li>
<li>Removing the part with wavelength &gt; 300 nm</li>
</ul>
<p>We have two issues here. First of all, there is no implemented method which allows you to convert reflectance spectra to absorbance (log(1/R)). Second is that MSC relies on a mean spectrum, it must be computed for the calibration set and then be re-used when apply the correction to a new data. Here is how to solve both:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="preprocessing-combine.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define calibration and test sets</span></span>
<span id="cb62-2"><a href="preprocessing-combine.html#cb62-2" aria-hidden="true" tabindex="-1"></a>Xc <span class="ot">&lt;-</span> simdata<span class="sc">$</span>spectra.c</span>
<span id="cb62-3"><a href="preprocessing-combine.html#cb62-3" aria-hidden="true" tabindex="-1"></a>Xt <span class="ot">&lt;-</span> simdata<span class="sc">$</span>spectra.t</span>
<span id="cb62-4"><a href="preprocessing-combine.html#cb62-4" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> simdata<span class="sc">$</span>wavelength</span>
<span id="cb62-5"><a href="preprocessing-combine.html#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(Xt, <span class="st">&quot;xaxis.values&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">attr</span>(Xc, <span class="st">&quot;xaxis.values&quot;</span>) <span class="ot">&lt;-</span> w</span>
<span id="cb62-6"><a href="preprocessing-combine.html#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(Xt, <span class="st">&quot;xaxis.name&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">attr</span>(Xc, <span class="st">&quot;xaxis.name&quot;</span>) <span class="ot">&lt;-</span> <span class="st">&quot;Wavelength, nm&quot;</span></span>
<span id="cb62-7"><a href="preprocessing-combine.html#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="preprocessing-combine.html#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="preprocessing-combine.html#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create a function for converting R to A</span></span>
<span id="cb62-10"><a href="preprocessing-combine.html#cb62-10" aria-hidden="true" tabindex="-1"></a>r2a <span class="ot">&lt;-</span> <span class="cf">function</span>(data) <span class="fu">return</span>(<span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">abs</span>(data)))</span>
<span id="cb62-11"><a href="preprocessing-combine.html#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="preprocessing-combine.html#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co"># compute mean spectrum for calibration set</span></span>
<span id="cb62-13"><a href="preprocessing-combine.html#cb62-13" aria-hidden="true" tabindex="-1"></a>ms <span class="ot">&lt;-</span> <span class="fu">apply</span>(Xc, <span class="dv">2</span>, mean)</span>
<span id="cb62-14"><a href="preprocessing-combine.html#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="preprocessing-combine.html#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequence of preprocessing methods</span></span>
<span id="cb62-16"><a href="preprocessing-combine.html#cb62-16" aria-hidden="true" tabindex="-1"></a>myprep <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb62-17"><a href="preprocessing-combine.html#cb62-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">prep</span>(<span class="st">&quot;r2a&quot;</span>, <span class="at">method =</span> r2a),</span>
<span id="cb62-18"><a href="preprocessing-combine.html#cb62-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">prep</span>(<span class="st">&quot;msc&quot;</span>, <span class="fu">list</span>(<span class="at">mspectrum =</span> ms)),</span>
<span id="cb62-19"><a href="preprocessing-combine.html#cb62-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">prep</span>(<span class="st">&quot;norm&quot;</span>, <span class="fu">list</span>(<span class="at">type =</span> <span class="st">&quot;area&quot;</span>)),</span>
<span id="cb62-20"><a href="preprocessing-combine.html#cb62-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">prep</span>(<span class="st">&quot;varsel&quot;</span>, <span class="fu">list</span>(<span class="at">var.ind =</span> w <span class="sc">&lt;</span> <span class="dv">300</span>))</span>
<span id="cb62-21"><a href="preprocessing-combine.html#cb62-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-22"><a href="preprocessing-combine.html#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="preprocessing-combine.html#cb62-23" aria-hidden="true" tabindex="-1"></a>Xcp <span class="ot">&lt;-</span> <span class="fu">employ.prep</span>(myprep, Xc)</span>
<span id="cb62-24"><a href="preprocessing-combine.html#cb62-24" aria-hidden="true" tabindex="-1"></a>Xtp <span class="ot">&lt;-</span> <span class="fu">employ.prep</span>(myprep, Xt)</span>
<span id="cb62-25"><a href="preprocessing-combine.html#cb62-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-26"><a href="preprocessing-combine.html#cb62-26" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb62-27"><a href="preprocessing-combine.html#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="fu">mdaplot</span>(Xc, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Calibration set, raw&quot;</span>)</span>
<span id="cb62-28"><a href="preprocessing-combine.html#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="fu">mdaplot</span>(Xt, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Test set, raw&quot;</span>)</span>
<span id="cb62-29"><a href="preprocessing-combine.html#cb62-29" aria-hidden="true" tabindex="-1"></a><span class="fu">mdaplot</span>(Xcp, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Calibration set, preprocessed&quot;</span>)</span>
<span id="cb62-30"><a href="preprocessing-combine.html#cb62-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mdaplot</span>(Xtp, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Test set, preprocessed&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-51-1.png" width="864" /></p>
<p>In this example I use <code>abs()</code> inside the function <code>r2a</code> to get rid of occasional negative values in the spectra caused by some noise.</p>
<p>As one can see, you can always define your own method by creating a function, whose first argument should always be <code>data</code> — like I did it with <code>r2a</code>. This function should treat the data as a matrix and return a matrix of the same dimension as the original data. Other parameters are optional. In my example <code>r2a</code> does not have any additional parameters therefore I skipped this argument when calling the <code>prep()</code> function.</p>
<p>And, as you probably notices, I just provided preliminary computed mean spectrum for the <code>"msc"</code> method. Now the object <code>myprep</code> can be saved together with a model to <code>RData</code> file and be reused when is needed.</p>

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="preprocessing--varsel.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="pca.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
